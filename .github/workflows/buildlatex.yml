name: Build All LaTeX Docs
on:
  push:
    paths-ignore:
      - paper.pdf


jobs:
  build_latex:
    runs-on: ubuntu-latest
    steps:
      - name: Check out repository
        uses: actions/checkout@v3

      - name: Install fonts
        run: |
          sudo apt-get update
          sudo apt-get install -y ttf-mscorefonts-installer
          sudo fc-cache -fv
          
      - name: Debug: list files
        run: ls -R week_2

      - name: Install TeX Live + latexmk
        run: |
          sudo apt-get install -y texlive-full latexmk

      - name: Compile all main.tex in subfolders
        run: |
          # Search for every 'main.tex' inside week_* directories (plus top-level if needed).
          for texfile in $(find . -type f -path "./week_*" -name "main.tex"); do
            echo "Compiling $texfile"
            # Adjust engine (lualatex / pdflatex) if needed:
            latexmk -lualatex -pdf -interaction=nonstopmode -halt-on-error -shell-escape "$texfile"
          done

      - name: Upload all generated PDFs
        uses: actions/upload-artifact@v4
        with:
          name: all_pdfs
          path: '**/*.pdf'
